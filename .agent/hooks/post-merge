#!/usr/bin/env python3
"""
Post-merge Git hook
Reminds developers to run migrations after pulling new code

To install this hook for your team:
1. Copy this file to: .git/hooks/post-merge
2. Make it executable (Mac/Linux): chmod +x .git/hooks/post-merge
"""
import os
import sys
import subprocess

def check_for_new_migrations():
    """Check if new migration files were added in the merge"""
    migrations_dir = os.path.join('backend', 'migrations')
    
    if not os.path.exists(migrations_dir):
        return False
    
    # Get list of changed files from git
    try:
        result = subprocess.run(
            ['git', 'diff-tree', '-r', '--name-only', '--no-commit-id', 'ORIG_HEAD', 'HEAD'],
            capture_output=True,
            text=True,
            check=True
        )
        changed_files = result.stdout.strip().split('\n')
        
        # Check if any migration files were added/modified
        migration_files = [f for f in changed_files if f.startswith('backend/migrations/') and f.endswith('.sql')]
        
        return len(migration_files) > 0
    except:
        # If git command fails, show reminder anyway to be safe
        return True

if __name__ == "__main__":
    if check_for_new_migrations():
        print("\n" + "=" * 60)
        print("  DATABASE MIGRATIONS DETECTED!")
        print("=" * 60)
        print("\n  New migration files were added in this pull.")
        print("  Please run migrations to update your database:\n")
        print("    cd backend")
        print("    python run_migrations.py\n")
        print("=" * 60 + "\n")
